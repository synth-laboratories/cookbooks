[prompt_learning]
algorithm = "gepa"
task_app_url = "http://127.0.0.1:8120"  # Will be overridden by InProcessTaskApp
task_app_api_key = "${ENVIRONMENT_API_KEY}"

[prompt_learning.initial_prompt]
id = "banking77_pattern"
name = "Banking77 Intent Classification Pattern"

[[prompt_learning.initial_prompt.messages]]
role = "system"
pattern = "You are an expert banking assistant that classifies customer queries into banking intents. Given a customer message, respond with exactly one intent label from the provided list using the `banking77_classify` tool."
order = 0

[[prompt_learning.initial_prompt.messages]]
role = "user"
pattern = "Customer Query: {query}\n\nAvailable Intents:\n{available_intents}\n\nClassify this query into one of the above banking intents using the tool call."
order = 1

[prompt_learning.initial_prompt.wildcards]
query = "REQUIRED"
available_intents = "REQUIRED"

[prompt_learning.policy]
inference_mode = "synth_hosted"
model = "gpt-4.1-nano"
provider = "openai"
temperature = 0.0
max_completion_tokens = 64

[prompt_learning.gepa]
env_name = "banking77"
proposer_effort = "MEDIUM"
proposer_output_tokens = "FAST"

[prompt_learning.gepa.evaluation]
# Large pareto set: 100 seeds for pareto scoring
# Large validation: 200 seeds for validation
# Total train: 120 seeds (100 for pareto, 20 for feedback)
seeds = { start = 0, end = 120 }
validation_seeds = { start = 120, end = 320 }
validation_pool = "train"
validation_top_k = 10  # Evaluate top 10 candidates on validation set

[prompt_learning.gepa.rollout]
budget = 500  # Enough rollouts to get 15 candidates
max_concurrent = 200
minibatch_size = 3

[prompt_learning.gepa.mutation]
rate = 0.3


[prompt_learning.gepa.population]
initial_size = 12
num_generations = 20  # Enough generations to get 20+ candidates
children_per_generation = 6

[prompt_learning.gepa.archive]
pareto_set_size = 40  # 40 seeds for pareto scoring
feedback_fraction = 0.667  # 80/120 = 0.667 feedback fraction (80 seeds for feedback, 40 for pareto)

[prompt_learning.gepa.token]
max_limit = 4096
counting_model = "gpt-4"

[prompt_learning.termination_config]
max_cost_usd = 20.0
max_trials = 300  # Enough trials to get 15 candidates (12 + 16*6 = 108 max, so 300 gives headroom)
